# Base Source API Documentation
# This file contains base source API paths and schemas to be integrated into the main Swagger documentation

paths:
  # ==========================================
  # BASE SOURCE ENDPOINTS
  # ==========================================
  /sources/agent/{agentId}:
    post:
      tags:
        - Base Sources
      summary: Create a new source for an agent
      description: Creates a new source for the specified agent (requires authentication)
      security:
        - bearerAuth: []
      parameters:
        - name: agentId
          in: path
          required: true
          description: Agent ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateSourceDto"
            examples:
              create_source:
                summary: Create file source
                value:
                  agent_id: 1
                  source_type: "file"
                  processing_metadata: '{"initial_processing": true}'
      responses:
        "201":
          description: Source created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleSourceResponse"
        "400":
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    get:
      tags:
        - Base Sources
      summary: Get all sources for an agent
      description: Retrieves all sources belonging to a specific agent (requires authentication)
      security:
        - bearerAuth: []
      parameters:
        - name: agentId
          in: path
          required: true
          description: Agent ID
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Sources retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AllSourcesResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Agent not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /sources/{id}:
    put:
      tags:
        - Base Sources
      summary: Update source
      description: Updates an existing source (requires authentication)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Source ID
          schema:
            type: integer
            example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateSourceDto"
            examples:
              update_source:
                summary: Update source status
                value:
                  status: "completed"
                  is_embedded: true
      responses:
        "200":
          description: Source updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleSourceResponse"
        "400":
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Source not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
    get:
      tags:
        - Base Sources
      summary: Get source by ID
      description: Retrieves a specific source by its ID (requires authentication)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Source ID
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Source retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingleSourceResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Source not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      tags:
        - Base Sources
      summary: Delete source
      description: Deletes a source (requires authentication)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Source ID
          schema:
            type: integer
            example: 1
      responses:
        "200":
          description: Source deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Source not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    BaseSource:
      type: object
      properties:
        id:
          type: integer
          description: Source unique identifier
          example: 1
        agent_id:
          type: integer
          description: ID of the agent this source belongs to
          example: 1
        source_type:
          type: string
          enum: [file, text, website, database, qa]
          description: Type of source
          example: "file"
        status:
          type: string
          enum: [pending, processing, completed, failed]
          description: Processing status of the source
          example: "completed"
        processing_metadata:
          type: string
          nullable: true
          description: JSON string containing processing details and metadata
          example: '{"tokens": 1500, "chunks": 3, "last_processed": "2025-07-30T14:33:39Z"}'
        is_embedded:
          type: boolean
          description: Whether the source content has been vectorized for embeddings
          example: true
        last_processed:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the source was last processed
          example: "2025-07-30T14:33:39Z"
        created_by:
          type: integer
          description: User ID who created this source
          example: 1
        created_at:
          type: string
          format: date-time
          description: Timestamp when the source was created
          example: "2025-07-30T14:33:39Z"
        updated_by:
          type: integer
          nullable: true
          description: User ID who last updated this source
          example: 1
        updated_at:
          type: string
          format: date-time
          description: Timestamp when the source was last updated
          example: "2025-07-30T14:33:39Z"
        is_deleted:
          type: boolean
          description: Whether the source is marked as deleted
          example: false
        deleted_by:
          type: integer
          nullable: true
          description: User ID who deleted this source
          example: null
        deleted_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the source was deleted
          example: null

    CreateSourceDto:
      type: object
      required:
        - agent_id
        - source_type
      properties:
        agent_id:
          type: integer
          description: ID of the agent this source belongs to
          example: 1
        source_type:
          type: string
          enum: [file, text, website, database, qa]
          description: Type of source
          example: "file"
        processing_metadata:
          type: string
          description: JSON string containing processing details and metadata
          example: '{"initial_processing": true}'

    UpdateSourceDto:
      type: object
      properties:
        status:
          type: string
          enum: [pending, processing, completed, failed]
          description: Processing status of the source
          example: "completed"
        processing_metadata:
          type: string
          description: JSON string containing processing details and metadata
          example: '{"tokens": 1500, "chunks": 3}'
        is_embedded:
          type: boolean
          description: Whether the source content has been vectorized for embeddings
          example: true

    SingleSourceResponse:
      type: object
      properties:
        data:
          $ref: "#/components/schemas/BaseSource"
        message:
          type: string
          example: "Source retrieved successfully"

    AllSourcesResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/BaseSource"
        message:
          type: string
          example: "Sources retrieved successfully"
